<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Personal Music Tool</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: white;
}

.section {
  padding: 15px;
  border-bottom: 1px solid #333;
}

.apple {
  background: #f5f5f5;
  color: black;
}

.youtube {
  background: #181818;
}

input, button {
  padding: 8px;
  font-size: 14px;
  margin-top: 5px;
}

button {
  cursor: pointer;
}

.result {
  cursor: pointer;
  margin: 6px 0;
}

iframe {
  border-radius: 12px;
}
</style>
</head>

<body>

<!-- ================= SPOTIFY ================= -->
<div class="section">
  <h3>Spotify Search (Preview)</h3>
  <button onclick="login()">Login to Spotify</button><br><br>

  <input id="sQuery" placeholder="Search Spotify song">
  <button onclick="spotifySearch()">Search</button>

  <div id="sResults"></div>
</div>

<!-- ================= APPLE MUSIC ================= -->
<div class="section apple">
  <h3>Apple Music Search (Full Song + Lyrics)</h3>

  <input id="aQuery" placeholder="Search Apple Music song">
  <button onclick="appleSearch()">Search</button>

  <div id="aResults"></div>
</div>

<!-- ================= YOUTUBE ================= -->
<div class="section youtube">
  <h3>YouTube Search (Full Song – Free)</h3>

  <input id="yQuery" placeholder="Search YouTube song">
  <button onclick="youtubeSearch()">Search</button>

  <div id="yResults"></div>
</div>

<!-- ================= PLAYER ================= -->
<div class="section" id="player"></div>

<script>
/* ---------- SPOTIFY LOGIN ---------- */
function login() {
  window.location.href = "/api/login";
}

/* ---------- SPOTIFY SEARCH ---------- */
async function spotifySearch() {
  const token = await fetch("/api/token")
    .then(r => r.json())
    .then(j => j.access_token);

  const q = sQuery.value;
  const r = await fetch(
    `https://api.spotify.com/v1/search?q=${encodeURIComponent(q)}&type=track&limit=5`,
    { headers: { Authorization: "Bearer " + token } }
  );
  const d = await r.json();

  sResults.innerHTML = "";
  d.tracks.items.forEach(t => {
    const div = document.createElement("div");
    div.className = "result";
    div.innerText = `${t.name} — ${t.artists[0].name}`;
    div.onclick = () => {
      player.innerHTML =
        `<iframe src="https://open.spotify.com/embed/track/${t.id}"
         width="100%" height="152"
         allow="autoplay; encrypted-media"></iframe>`;
    };
    sResults.appendChild(div);
  });
}

/* ---------- APPLE MUSIC SEARCH ---------- */
async function appleSearch() {
  const q = aQuery.value;
  const r = await fetch(
    `https://itunes.apple.com/search?term=${encodeURIComponent(q)}&entity=song&limit=5`
  );
  const d = await r.json();

  aResults.innerHTML = "";
  d.results.forEach(t => {
    const div = document.createElement("div");
    div.className = "result";
    div.innerText = `${t.trackName} — ${t.artistName}`;
    div.onclick = () => {
      player.innerHTML =
        `<iframe src="${t.trackViewUrl.replace(
          "music.apple.com",
          "embed.music.apple.com"
        )}"
         width="100%" height="150"
         allow="autoplay; encrypted-media"></iframe>`;
    };
    aResults.appendChild(div);
  });
}

/* ---------- YOUTUBE SEARCH (SECURE) ---------- */
async function youtubeSearch() {
  const q = yQuery.value;

  const r = await fetch(
    `/api/youtube-search?q=${encodeURIComponent(q)}`
  );
  const d = await r.json();

  yResults.innerHTML = "";
  d.items.forEach(v => {
    const div = document.createElement("div");
    div.className = "result";
    div.innerText = v.snippet.title;
    div.onclick = () => {
      player.innerHTML =
        `<iframe width="100%" height="220"
         src="https://www.youtube.com/embed/${v.id.videoId}"
         allow="autoplay; encrypted-media"
         allowfullscreen></iframe>`;
    };
    yResults.appendChild(div);
  });
}
</script>

</body>
</html>
