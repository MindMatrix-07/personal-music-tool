<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Music Tool</title>

<style>
:root {
  /* Light Mode */
  --bg-primary: #ffffff;
  --bg-secondary: #f8f9fa;
  --bg-card: #ffffff;
  --bg-input: #f1f3f5;
  --text-primary: #212529;
  --text-secondary: #6c757d;
  --border-color: #dee2e6;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
  
  /* Platform Colors */
  --spotify-green: #1db954;
  --spotify-green-hover: #1ed760;
  --apple-red: #fa243c;
  --apple-red-hover: #ff3b5c;
  --youtube-red: #ff0000;
  --youtube-red-hover: #ff1a1a;
  
  /* Transitions */
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] {
  /* Dark Mode */
  --bg-primary: #0f0f0f;
  --bg-secondary: #1a1a1a;
  --bg-card: #1e1e1e;
  --bg-input: #2a2a2a;
  --text-primary: #ffffff;
  --text-secondary: #b3b3b3;
  --border-color: #333333;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: var(--transition);
  min-height: 100vh;
  line-height: 1.6;
}

/* Top Bar */
.top-bar {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-sm);
}

.top-bar-left {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.platform-tab {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  color: white;
  position: relative;
  overflow: hidden;
}

.platform-tab::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.2);
  transition: left 0.3s;
}

.platform-tab:hover::before {
  left: 100%;
}

.platform-tab.active {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.platform-tab.spotify {
  background: var(--spotify-green);
}

.platform-tab.spotify:hover {
  background: var(--spotify-green-hover);
}

.platform-tab.apple {
  background: var(--apple-red);
}

.platform-tab.apple:hover {
  background: var(--apple-red-hover);
}

.platform-tab.youtube {
  background: var(--youtube-red);
}

.platform-tab.youtube:hover {
  background: var(--youtube-red-hover);
}

.theme-toggle {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  padding: 0.5rem 1rem;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1.2rem;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.theme-toggle:hover {
  background: var(--bg-input);
  transform: scale(1.05);
}

/* Main Layout */
.main-container {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 2rem;
  padding: 2rem;
  max-width: 1600px;
  margin: 0 auto;
}

/* Left Column - Search Area */
.search-area {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.search-panel {
  display: none;
  animation: fadeIn 0.3s ease-in;
}

.search-panel.active {
  display: block;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.search-card {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
}

.search-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
}

.search-header h2 {
  font-size: 1.5rem;
  font-weight: 700;
}

.spotify-login-btn {
  background: var(--spotify-green);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  font-size: 0.9rem;
}

.spotify-login-btn:hover {
  background: var(--spotify-green-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.search-input-group {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.search-input {
  flex: 1;
  padding: 0.875rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  background: var(--bg-input);
  color: var(--text-primary);
  font-size: 1rem;
  transition: var(--transition);
}

.search-input:focus {
  outline: none;
  border-color: var(--spotify-green);
  box-shadow: 0 0 0 3px rgba(29, 185, 84, 0.1);
}

.search-btn {
  padding: 0.875rem 1.5rem;
  border: none;
  border-radius: 12px;
  background: var(--spotify-green);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  font-size: 1rem;
}

.search-btn:hover {
  background: var(--spotify-green-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.search-btn.apple {
  background: var(--apple-red);
}

.search-btn.apple:hover {
  background: var(--apple-red-hover);
}

.search-btn.youtube {
  background: var(--youtube-red);
}

.search-btn.youtube:hover {
  background: var(--youtube-red-hover);
}

.results-container {
  margin-top: 1rem;
}

.result-item {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  cursor: pointer;
  transition: var(--transition);
}

.result-item:hover {
  background: var(--bg-input);
  transform: translateX(4px);
  box-shadow: var(--shadow-sm);
  border-color: var(--spotify-green);
}

.result-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.25rem;
  font-size: 1rem;
}

.result-artist {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

/* Right Column - Player Card */
.player-card {
  position: sticky;
  top: 100px;
  background: var(--bg-card);
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-color);
  height: fit-content;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
}

.player-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.player-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--text-primary);
}

.platform-badge {
  padding: 0.35rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.platform-badge.spotify {
  background: var(--spotify-green);
  color: white;
}

.platform-badge.apple {
  background: var(--apple-red);
  color: white;
}

.platform-badge.youtube {
  background: var(--youtube-red);
  color: white;
}

.player-content {
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: 1rem;
}

.player-placeholder {
  text-align: center;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.player-embed {
  width: 100%;
  border-radius: 12px;
  overflow: hidden;
}

.player-embed iframe {
  width: 100%;
  border: none;
  border-radius: 12px;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .main-container {
    grid-template-columns: 1fr;
  }
  
  .player-card {
    position: relative;
    top: 0;
    max-height: none;
  }
}

@media (max-width: 768px) {
  .top-bar {
    padding: 1rem;
    flex-direction: column;
    gap: 1rem;
  }
  
  .top-bar-left {
    width: 100%;
    justify-content: center;
  }
  
  .platform-tab {
    flex: 1;
    min-width: 100px;
    padding: 0.6rem 1rem;
    font-size: 0.85rem;
  }
  
  .main-container {
    padding: 1rem;
    gap: 1.5rem;
  }
  
  .search-card {
    padding: 1rem;
  }
  
  .player-card {
    padding: 1rem;
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}
</style>
</head>

<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <button class="platform-tab spotify active" data-platform="spotify">
        üéµ Spotify
      </button>
      <button class="platform-tab apple" data-platform="apple">
        üçé Apple Music
      </button>
      <button class="platform-tab youtube" data-platform="youtube">
        ‚ñ∂Ô∏è YouTube
      </button>
    </div>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <span id="themeIcon">üåô</span>
      <span id="themeText">Dark</span>
    </button>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Left Column - Search Area -->
    <div class="search-area">
      <!-- Spotify Search Panel -->
      <div class="search-panel active" id="spotifyPanel">
        <div class="search-card">
          <div class="search-header">
            <h2>Spotify Search</h2>
            <button class="spotify-login-btn" onclick="login()">Login</button>
          </div>
          <div class="search-input-group">
            <input 
              type="text" 
              id="sQuery" 
              class="search-input" 
              placeholder="Search for songs, artists, albums..."
              onkeypress="if(event.key === 'Enter') spotifySearch()"
            >
            <button class="search-btn" onclick="spotifySearch()">Search</button>
          </div>
          <div class="results-container" id="sResults"></div>
        </div>
      </div>

      <!-- Apple Music Search Panel -->
      <div class="search-panel" id="applePanel">
        <div class="search-card">
          <div class="search-header">
            <h2>Apple Music Search</h2>
          </div>
          <div class="search-input-group">
            <input 
              type="text" 
              id="aQuery" 
              class="search-input" 
              placeholder="Search for songs, artists, albums..."
              onkeypress="if(event.key === 'Enter') appleSearch()"
            >
            <button class="search-btn apple" onclick="appleSearch()">Search</button>
          </div>
          <div class="results-container" id="aResults"></div>
        </div>
      </div>

      <!-- YouTube Search Panel -->
      <div class="search-panel" id="youtubePanel">
        <div class="search-card">
          <div class="search-header">
            <h2>YouTube Search</h2>
          </div>
          <div class="search-input-group">
            <input 
              type="text" 
              id="yQuery" 
              class="search-input" 
              placeholder="Search for songs, videos..."
              onkeypress="if(event.key === 'Enter') youtubeSearch()"
            >
            <button class="search-btn youtube" onclick="youtubeSearch()">Search</button>
          </div>
          <div class="results-container" id="yResults"></div>
        </div>
      </div>
    </div>

    <!-- Right Column - Player Card -->
    <div class="player-card">
      <div class="player-header">
        <div class="player-title">Now Playing</div>
        <div class="platform-badge" id="playerBadge" style="display: none;">Spotify</div>
      </div>
      <div class="player-content" id="player">
        <div class="player-placeholder">
          Select a song to start playing
        </div>
      </div>
    </div>
  </div>

  <script>
    // Current active platform
    let currentPlatform = 'spotify';
    let currentPlayerPlatform = null;

    // Theme Management
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    const html = document.documentElement;

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);

    function updateThemeIcon(theme) {
      if (theme === 'dark') {
        themeIcon.textContent = 'üåô';
        themeText.textContent = 'Dark';
      } else {
        themeIcon.textContent = '‚òÄÔ∏è';
        themeText.textContent = 'Light';
      }
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });

    // Platform Tab Switching
    const platformTabs = document.querySelectorAll('.platform-tab');
    const searchPanels = document.querySelectorAll('.search-panel');

    platformTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const platform = tab.dataset.platform;
        switchPlatform(platform);
      });
    });

    function switchPlatform(platform) {
      currentPlatform = platform;

      // Update active tab
      platformTabs.forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-platform="${platform}"]`).classList.add('active');

      // Update active panel
      searchPanels.forEach(p => p.classList.remove('active'));
      document.getElementById(`${platform}Panel`).classList.add('active');

      // Update search button color
      const searchBtns = document.querySelectorAll('.search-btn');
      searchBtns.forEach(btn => {
        btn.classList.remove('spotify', 'apple', 'youtube');
        btn.classList.add(platform);
      });
    }

    // Update Player Badge
    function updatePlayerBadge(platform) {
      const badge = document.getElementById('playerBadge');
      if (platform) {
        badge.textContent = platform.charAt(0).toUpperCase() + platform.slice(1);
        badge.className = `platform-badge ${platform}`;
        badge.style.display = 'block';
        currentPlayerPlatform = platform;
      } else {
        badge.style.display = 'none';
        currentPlayerPlatform = null;
      }
    }

    // Update Player
    function updatePlayer(embedHtml, platform) {
      const player = document.getElementById('player');
      player.innerHTML = `<div class="player-embed">${embedHtml}</div>`;
      updatePlayerBadge(platform);
      
      // Auto-switch to the platform tab
      if (platform !== currentPlatform) {
        switchPlatform(platform);
      }
    }

    // Spotify Login
    function login() {
      window.location.href = "/api/login";
    }

    // Spotify Search
    async function spotifySearch() {
      const query = document.getElementById('sQuery').value.trim();
      if (!query) return;

      const sResults = document.getElementById('sResults');
      sResults.innerHTML = '<div class="player-placeholder">Searching...</div>';

      try {
        const tokenResponse = await fetch("/api/token");
        const tokenData = await tokenResponse.json();
        
        if (!tokenData.access_token) {
          sResults.innerHTML = '<div class="player-placeholder">Please login to Spotify first</div>';
          return;
        }

        const response = await fetch(
          `https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`,
          { headers: { Authorization: "Bearer " + tokenData.access_token } }
        );
        const data = await response.json();

        sResults.innerHTML = "";
        if (data.tracks && data.tracks.items.length > 0) {
          data.tracks.items.forEach(track => {
            const div = document.createElement("div");
            div.className = "result-item";
            div.innerHTML = `
              <div class="result-title">${track.name}</div>
              <div class="result-artist">${track.artists.map(a => a.name).join(', ')}</div>
            `;
            div.onclick = () => {
              const embedHtml = `<iframe src="https://open.spotify.com/embed/track/${track.id}" width="100%" height="152" frameborder="0" allowtransparency="true" allow="autoplay; encrypted-media"></iframe>`;
              updatePlayer(embedHtml, 'spotify');
            };
            sResults.appendChild(div);
          });
        } else {
          sResults.innerHTML = '<div class="player-placeholder">No results found</div>';
        }
      } catch (error) {
        sResults.innerHTML = '<div class="player-placeholder">Error searching. Please try again.</div>';
        console.error('Spotify search error:', error);
      }
    }

    // Apple Music Search
    async function appleSearch() {
      const query = document.getElementById('aQuery').value.trim();
      if (!query) return;

      const aResults = document.getElementById('aResults');
      aResults.innerHTML = '<div class="player-placeholder">Searching...</div>';

      try {
        const response = await fetch(
          `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=10`
        );
        const data = await response.json();

        aResults.innerHTML = "";
        if (data.results && data.results.length > 0) {
          data.results.forEach(track => {
            const div = document.createElement("div");
            div.className = "result-item";
            div.innerHTML = `
              <div class="result-title">${track.trackName}</div>
              <div class="result-artist">${track.artistName}</div>
            `;
            div.onclick = () => {
              const embedUrl = track.trackViewUrl.replace(
                "music.apple.com",
                "embed.music.apple.com"
              );
              const embedHtml = `<iframe src="${embedUrl}" width="100%" height="150" frameborder="0" allowtransparency="true" allow="autoplay; encrypted-media"></iframe>`;
              updatePlayer(embedHtml, 'apple');
            };
            aResults.appendChild(div);
          });
        } else {
          aResults.innerHTML = '<div class="player-placeholder">No results found</div>';
        }
      } catch (error) {
        aResults.innerHTML = '<div class="player-placeholder">Error searching. Please try again.</div>';
        console.error('Apple Music search error:', error);
      }
    }

    // YouTube Search
    async function youtubeSearch() {
      const query = document.getElementById('yQuery').value.trim();
      if (!query) return;

      const yResults = document.getElementById('yResults');
      yResults.innerHTML = '<div class="player-placeholder">Searching...</div>';

      try {
        const response = await fetch(
          `/api/youtube-search?q=${encodeURIComponent(query)}`
        );
        const data = await response.json();

        yResults.innerHTML = "";
        if (data.items && data.items.length > 0) {
          data.items.forEach(video => {
            const div = document.createElement("div");
            div.className = "result-item";
            div.innerHTML = `
              <div class="result-title">${video.snippet.title}</div>
              <div class="result-artist">${video.snippet.channelTitle}</div>
            `;
            div.onclick = () => {
              const embedHtml = `<iframe width="100%" height="220" src="https://www.youtube.com/embed/${video.id.videoId}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
              updatePlayer(embedHtml, 'youtube');
            };
            yResults.appendChild(div);
          });
        } else {
          yResults.innerHTML = '<div class="player-placeholder">No results found</div>';
        }
      } catch (error) {
        yResults.innerHTML = '<div class="player-placeholder">Error searching. Please try again.</div>';
        console.error('YouTube search error:', error);
      }
    }
  </script>
</body>
</html>
